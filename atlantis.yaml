version: 3

projects:
  - name: my-app-infra
    dir: .
    workspace: default
    autoplan:
      when_modified: ["*.tf", "*.tfvars", "../modules/**/*.tf"]
      enabled: true
    apply_requirements: [mergeable]
    workflow: default
  - name: my-app-infra-prod
    dir: .
    workspace: default
    autoplan:
      when_modified: ["*.tf", "*.tfvars", "../modules/**/*.tf"]
      enabled: true
    apply_requirements: [mergeable]
    workflow: prod
    branch: /^release-*/

workflows:
  default:
    plan:
      steps:
        - init
        - plan
    apply:
      steps:
        - apply
  prod:
    plan:
      steps:
        - init
        - plan
    apply:
      steps:
        - apply